---
title: "Homework #1"
output: html_document
---

```{r}
str_vec <- c("1.19", "6.24", "1.68", "3.56", "7.16", "7.43", "4.44", "0.4", "4.44", "4.48", "0.77", "5.2", "3.85", "2.55", "4.74", "2.48", "4.22", "4.47", "5.66", "4.67", "4.5", "8.43", "1.1", "2.66", "8.93")    # вектор із строками. це строки а не числа, тому що в лапках

# помилка, тому що строки не розуміють оператора "+":
str_vec[1] + str_vec[2]
```

## Завдання 1. Перетворити кожен елемент `str_vec` в число, "double", за допомогою цикла `for`
Як???
1. Створити новий пустий вектор, у якому будемо зберігати перетворені числа `double_vec <- c()`
2. Пройти по всім елементам вектора ´`str_vec` за допомогою циклу `for (e in vvv) { … }`
3. У тілі циклу (`{ … }` на місці 3-х крапок) перетворити елемент в число. Там же, всередині циклу, не забудьте, що виконання якоїсь функції до елемента не перетворює його, результат перетворення треба зберегти у змінній
4. У тілі циклу додати перетворений число до нового вектора з перетвореними числами `double_vec`. Як це зробити — пошукайте англійською, накшталт «R how to append item to vector», https://stackoverflow.com — ваш кращий друг у світі програмування

```{r}
# do it here

```


## Завдання 2. Забута векторизація: перетворіть `str_vec` на числовий вектор в 1 рядок коду
Застосуйте перетворюючу фенкцію `as.…` до всього вектора
```{r}

```

## Завдання 3. Перевірте, що тепер з елементами перетвореного вектора можна здійснювати арифметичні операції
Знайдіть суму, середнє, медіану, стандартне відхилення (standart deviation) вектора
```{r}

```

### Завдання 4
```{r}
library(tidyverse)
url <- "https://data.gov.ua/dataset/5ef5d228-7661-4485-a1ba-b04d7d2c6302/resource/1f248923-b4bf-4f98-a2af-c5c47517e1bf/download/dg_year.csv"
df <- read.csv(url(url))
df$Дата <- as.POSIXct(df$Дата, format = "%d.%m.%Y %H:%M:%S")    # date column as date, not as character
head(df)
```
Це дані генерації електроенергії з порталу відкритих даних.

### 1. Знайдіть середнє, медіану, стандартне відхилення (standart deviation) споживання за годину (колонка "Споживання")
```{r}

```

### 2. Знайдіть середній відсоток та [квантилі](https://en.wikipedia.org/wiki/Quantile) `quantile()` генерації відтворюваної енергії (колонка "Генерація.з.ВДЕ") за допомогою бібліотеки *dplyr*.
Використайте функції `select`, `rowSums` та `mutate` щоб порахувати, скільки всього енергії виробляли.
Також пам'ятайте про `df %>% do_smth() %>% do_smth_else()  …`

Відсоток рахується як значення частини ("Генерація.з.ВДЕ") поділене на суму цілого

Підказка, як зробити колонку суми по рядках: `… %>% mutate(total = rowSums(.) %>% …`. Крапка в dplyr у пайпі(`%>%`) означає поточні дані

```{r}
generation_columns <- c("ГЕС", "АЕС", "ГАЕС.генерація.", "ТЕЦ", "Генерація.з.ВДЕ", "ТЕС", "ГАЕС.закачка.")

calc <- df %>%
  select(generation_columns) %>%
  mutate(total = rowSums(.),
         green = Генерація.з.ВДЕ / total)

quantile(calc$green, c(0.25, 0.5, 0.75))

```


```{r}
url <- "https://data.gov.ua/dataset/5ef5d228-7661-4485-a1ba-b04d7d2c6302/resource/1f248923-b4bf-4f98-a2af-c5c47517e1bf/download/dg_year.csv"

df <- read.csv(url(url))
df$Дата <- as.POSIXct(df$Дата, format = "%d.%m.%Y %H:%M:%S")    # date column as date, not as character

df$w <- factor(weekdays(df$Дата),
              levels = c("понеділок", "вівторок", "середа", "четвер", "п'ятниця", "субота", "неділя"))

df$h <- factor(hour(df$Дата), levels = 0:23)
df$Споживання <- df$Споживання / 1000

mean_consumption <- df %>% 
  group_by(h, w) %>%
  summarize(cons = median(Споживання))

mean_consumption$h

pl <- df %>% ggplot(aes(hour(df$Дата), df$Споживання)) +
  geom_step(data = mean_consumption,
            aes(mean_consumption$h, mean_consumption$cons, group = w),
            color = "#253494",
            alpha = 0.9) +
  geom_jitter(size = 0.25, alpha = 0.25, color = "#253494") +
  # facet_wrap(vars(w)) +
  labs(title = "Погодинне споживання електрики, 2020", x = "Година доби", y = "Споживання, тис. МВт", color = NULL) +
  facet_wrap(vars(w)) +
  scale_x_discrete(breaks = seq(0, 24, 6),
                   labels = map(seq(0, 24, 6),
                                function(l) { paste(l, ":00", sep="") })) +
  theme_minimal(base_family = "Proxima Nova") +
  theme(plot.margin = margin(13.3, 13.3, 13.3, 13.3, "mm"))

pl

ggsave("electro.svg", pl, width = 158.75, units = "mm")
```

?geom_jitter

