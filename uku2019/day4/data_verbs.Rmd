---
title: "Verbd to work with data"
output: html_document
---

### Граматика роботи з даними. Основні дієслова:

(Дієслово-назва функції в dplyr)  --- (аналог цієї операції з даними в Екселі)
1. select() --- вибрати колонки
2. arrange() --- сортувати за значенням в колонці
3. filter()  --- створити фільтер
4. mutate() --- використати формулу і наявні дані, для того щоб підрахувати значення для нової колонки 
5. group_by() + summarize() --- аналог pivot table в Excel


```{r}
library(dplyr) # main library to work with data, provides all verbs 
library(readr) # to import data from different formats (csv, excel, etc)

df <- read_csv("data/declarations.csv")  # мій файл з даними називається "declarations.csv"

```


### Verbs: select()
Нагадую, оператор "%>%" (конвеєр, або труба) означає взяти ліву сторону виразу і передати її вправо, як перший аргумент для функції, що стоїть одразу після нього праворуч. Цей оператор дозволяє впорядкованим чином, крок за кроком, робити перетворення даних які нам потрібні 



```{r}

library(dplyr)

# у цьому випадку, ми передаємо нашу табличку з даними df, як перший аргумент для функції select()
df1 <- df %>% select(full_name, name, off, income, income_family)

# цей варіант краще читається - кожна дієслово по роботі з даними має бути в новій строці
df1 <- df %>% 
  select(full_name, name, off, income, income_family)

```


### Verbs: arrange()  (Sort in Excel)  

```{r}
df1 %>%
  arrange(income) # sort by "income" column, ascending

# для того, щоб сортувати в спадаючому порядку, використовуйте знак "-" або функцію desc()
df1 %>%
  arrange(-income) # sort by "income" column, descending

df1 %>%
  arrange(desc(income) ) # sort by "income" column, descending

```

  
### Verbs: filter()
Функція filter() вибирає лише ті рядки з таблиці, які відповідають нашим умовам.

```{r}
df2 <- df1 %>%
  filter(off == "парламент") # вибрати всі записи(рядки), де в колонці off вказано "парламент"

df2 <- df1 %>%
  filter(off == "парламент", income > 4000000) # вибрати всі записи(рядки), де в колонці off вказано "парламент" ТА задекларований дохід > 4000000. Зверніть увагу, що "==" розшивфровується як "дорівнює"

```


# Verbs: mutate()
Створюємо нову колонку, підраховуємо нові значення  для неї за будь якою формулою(функцією)

```{r}

df3 <- df1 %>%
  mutate(person_family_ratio = income / income_family) # створюємо нову колонку з назвою person_family_ratio, і значеннями що дорівнюють співвідношенню доходу і доходу родини

df4 <- df %>%
  mutate(income_usd = income/28,  total_cars = cars + cars_family) #  створюємо дві нові колонки, income_usd та total_cars

```


### Домашнє завдання, №2


Знайдіть наступне у наших даних
1. сумарну площу всього житла для кожного рядка (створіть нову колонку)
2. сумарний дохід родини та персони (створіть нову колонку)
3. відфільтруйте всіх, у кого сумарна площа менше 100 м2 та сумарний дохід > 1 млн гривень
4. відсортуйте по зменшенню сумарного доходу
5. виберіть з початкової таблиці лише все, що пов'язане з іменем та підрахованими даними
6. скомбінуйте пункти 1,2,3,4,5 в один вираз за допомогою операторів %>%, призначте цю нову таблицю змінній з назвою df_new, та зберіжіть її у файлі





